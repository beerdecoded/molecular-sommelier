# ğŸº Molecular Beer Recommendation App

A static Single Page Application (SPA) that recommends beers based on molecular similarity using Raman spectra and yeast phylogenetic distance.

## ğŸš€ Quick Start

### Prerequisites
- Node.js (v18 or higher)
- npm

### Installation

1. **Install dependencies:**
   ```bash
   npm install
   ```

2. **Run the ETL script to process data:**
   ```bash
   npm run etl
   ```
   
   This will:
   - Parse raw CSV files (`beers-db.csv`, `raman-data.csv`, `yeast-data.csv`)
   - Parse the Newick phylogenetic tree (`yeast-tree.nwk`)
   - Align IDs across all datasets
   - Round Raman vectors to 4 decimal places
   - Calculate relative abundances for yeast data
   - Output optimized JSON files to `public/data/`

3. **Start the development server:**
   ```bash
   npm run dev
   ```

4. **Open your browser:**
   Navigate to `http://localhost:5173`

## ğŸ“ Project Structure

```
beerdecoded/
â”œâ”€â”€ raw_data/              # Raw CSV and Newick files
â”‚   â”œâ”€â”€ beers-db.csv
â”‚   â”œâ”€â”€ raman-data.csv
â”‚   â”œâ”€â”€ yeast-data.csv
â”‚   â””â”€â”€ yeast-tree.nwk
â”œâ”€â”€ public/
â”‚   â””â”€â”€ data/              # Processed JSON files (generated by ETL)
â”‚       â”œâ”€â”€ beers.json     # Beer metadata
â”‚       â”œâ”€â”€ raman.json     # Raman spectra (2048 floats per beer)
â”‚       â”œâ”€â”€ yeast.json     # Yeast abundance (relative)
â”‚       â””â”€â”€ tree.json      # Phylogenetic tree structure
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/        # React components
â”‚   â”œâ”€â”€ utils/            # Math and bio logic
â”‚   â”œâ”€â”€ engine/           # Recommendation engine
â”‚   â””â”€â”€ context/          # Data and state management
â”œâ”€â”€ etl.js                # ETL script
â””â”€â”€ package.json
```

## ğŸ§¬ Data Processing (ETL)

### Input Files (in `raw_data/`)
- **beers-db.csv**: Beer metadata (ID, Name, Brewery, Style, ABV, etc.)
- **raman-data.csv**: Raman spectroscopy data (2048 wavenumbers per beer)
- **yeast-data.csv**: Yeast species abundance (read counts)
- **yeast-tree.nwk**: Phylogenetic tree in Newick format

### Output Files (in `public/data/`)

#### `beers.json`
Array of beer objects:
```json
[
  {
    "id": 1,
    "name": "Wittekop",
    "brewery": "Brasserie Lefebvre",
    "country": "Belgium",
    "region": "Europe",
    "style": "Witbier",
    "abv": 4.5,
    "ibu": 12,
    "srm": 4,
    "has_yeast_data": false
  }
]
```

#### `raman.json`
Object mapping beer ID to Raman spectrum (2048 floats):
```json
{
  "1": [0.0123, 0.0456, ...],
  "2": [0.0789, 0.0234, ...]
}
```

#### `yeast.json`
Object mapping beer ID to relative species abundances:
```json
{
  "3": {
    "Saccharomyces cerevisiae": 0.85,
    "Brettanomyces bruxellensis": 0.15
  }
}
```

#### `tree.json`
Nested tree structure with branch lengths:
```json
{
  "name": "",
  "length": 0,
  "children": [
    {
      "name": "Saccharomyces cerevisiae",
      "length": 0.0123,
      "children": []
    }
  ]
}
```

## ğŸ¨ Design System

### Biohacker Theme
- **Canvas**: `#020617` (slate-950) - Deep blue-black background
- **Surface**: `#0f172a` (slate-900) - Card backgrounds
- **Primary Accent**: `#FACC15` (yellow-400) - "Vibrant Yellow"
- **Text Primary**: `#f8fafc` (slate-50)
- **Text Data**: `#4ade80` (green-400) - Monospace data values
- **Text Muted**: `#94a3b8` (slate-400)

### Typography
- **UI**: Inter (headings, navigation)
- **Data**: JetBrains Mono (numbers, IDs, scores)

## ğŸ§ª ETL Script Details

The `etl.js` script includes:

### Features
- âœ… Robust CSV parsing (handles quoted values)
- âœ… Newick tree parser (custom implementation)
- âœ… Data alignment across datasets
- âœ… Automatic filtering of control samples (water, empty cells)
- âœ… Raman float rounding (4 decimal places)
- âœ… Yeast abundance normalization (raw counts â†’ relative abundances)
- âœ… Comprehensive error handling
- âœ… Progress logging

### Running the ETL Script

```bash
# Run the ETL script
npm run etl
```

**Expected Output:**
```
Starting ETL process...

Processing beers database...
Processed 118 beers
Processing Raman spectra...
Processed Raman data for 118 beers
Processing yeast abundance data...
Processed yeast data for 39 beers
Processing phylogenetic tree...
Phylogenetic tree processed successfully

Writing output files...
âœ“ beers.json
âœ“ raman.json
âœ“ yeast.json
âœ“ tree.json

âœ… ETL process completed successfully!

Summary:
- 118 beers
- 118 Raman spectra
- 39 yeast profiles
- Phylogenetic tree with 174 nodes
```

## ğŸ”¬ Recommendation Algorithm

### Similarity Metrics

1. **Raman Similarity (SFEC)**
   - Squared First-Difference Euclidean Cosine
   - Differentiates spectra, then calculates cosine similarity

2. **Yeast Similarity (Weighted UniFrac)**
   - Phylogenetic distance between yeast communities
   - Uses branch lengths and relative abundances

### Golden Ratio Scoring
- **Both have yeast data**: `S_total = 0.618 Ã— S_raman + 0.382 Ã— S_yeast`
- **Missing yeast data**: `S_total = 0.618 Ã— S_raman`

### Barman Modes
- **Comfort Zone**: Top 90-100th percentile (default)
- **Wander Away**: 75-90th percentile (if time > 3 min AND low homogeneity)

## ğŸ“¦ Build for Production

```bash
npm run build
```

This creates an optimized static build in the `dist/` folder ready for deployment.

## ğŸ› ï¸ Development

```bash
# Start dev server
npm run dev

# Run linter
npm run lint

# Build for production
npm run build

# Preview production build
npm run preview
```

## ğŸ“ Notes

- The app is **100% client-side** - no backend required
- All data is loaded into memory on app start
- Total data size: ~1.4 MB (acceptable for modern browsers)
- Recommendation engine runs in-browser (fast for this dataset size)

## ğŸ§¬ Data Sources

- **Raman Spectra**: Molecular fingerprints of beer samples
- **Yeast Data**: ITS1 sequencing of yeast communities
- **Phylogenetic Tree**: Evolutionary relationships between yeast species

---

Built with â¤ï¸ using React, Vite, TypeScript, and Tailwind CSS
